[% IF ward %]
    [% name = "$ward.name, $council.name"
       thing = loc('ward')
    %]
[% ELSE %]
    [% name = council.name
       thing = loc('council')
    %]
[% END %]

[% INCLUDE 'header.html',
    title = tprintf(loc('%s - Summary reports'), name)
    context = 'reports'
    rss = [ tprintf(loc('Problems within %s, FixMyStreet'), name), rss_url ]
%]

<p><a href="[% rss_url %]"><img align="right" src="/i/feed.png" width="16" height="16" title="[% loc('RSS feed') %]" alt="[% tprintf(loc('RSS feed of problems in this %s'), thing) %]" border="0" hspace="4"></a>

[% IF c.cobrand.all_councils_report %]
    [% tprintf( loc('This is a summary of all reports for one %s.'), thing ) %]
[% ELSE %]
    [% tprintf( loc('This is a summary of all reports for this %s.'), thing ) %]
[% END %]

[%# FIXME: It should link to council from a ward page, and should have list of wards on a council page. And a map? 
    The reason c.req.base/path is used below is that passing undef to uri_with
    in a template actually passes "", and so the key still appears in the URL.
%]

[% IF c.req.parameters.all AND !c.cobrand.all_councils_report %]
    [% tprintf( loc('You can <a href="%s">see less detail</a>.'), c.req.base _ c.req.path ) %]
[% ELSIF !c.cobrand.all_councils_report %]
    [% tprintf( loc('You can <a href="%s">see more details</a>.'), c.req.uri_with( { all = 1 } ) ) %]
[% ELSIF c.req.parameters.all %]
    [% tprintf( loc('You can <a href="%s">see less detail</a> or go back and <a href="/reports">show all councils</a>.'), c.req.base _ c.req.path ) %]
[% ELSE %]
    [% tprintf( loc('You can <a href="%s">see more details</a> or go back and <a href="/reports">show all councils</a>.'), c.req.uri_with( { all = 1 } ) ) %]
[% END %]

<h2>[% name %]</h2>

<div id="col_problems">
    [% INCLUDE column
        title = loc('New problems')
        problems = open.${council.id}.new
    %]

    [%# This doesn't really need a whole separate template %]
    [% IF c.cobrand.moniker == 'emptyhomes' %]
        [% 
           INCLUDE column
            title = loc('Older problems')
            problems = open.${council.id}.older.merge( open.${council.id}.unknown )
        %]
    [% ELSE %]
        [% INCLUDE column
            title = loc('Older problems')
            problems = open.${council.id}.older
        %]
        [% INCLUDE column
            title = loc('Old problems, state unknown')
            problems = open.${council.id}.unknown
        %]
    [% END %]
</div>

<div id="col_fixed">
    [% INCLUDE column
        title = loc('Recently fixed')
        problems = fixed.${council.id}.new
    %]
    [% INCLUDE column
        title = loc('Old fixed')
        problems = fixed.${council.id}.old
    %]
</div>

[% INCLUDE 'footer.html' %]

[% BLOCK column %]
[% IF problems %]

<h3>[% title %]</h3>

<ul>
[% FOREACH problem IN problems %]
    <li><a href="[% c.uri_for('/report/' _ problem.id) %]">[% problem.title | html %]</a>
    [% IF problem.councils > 1 %] <small>[% loc('(sent to both)') %]</small> [% END %]
    [% IF c.cobrand.moniker != 'emptyhomes' %]
        [% IF problem.councils == 0 %] <small>[% loc('(not sent to council)') %]</small> [% END %]
    [% END %]
    [% IF all %] <br><small>[% problem.detail %]</small> [% END %]
    </li>
[% END %]
</ul>

[% END %]
[% END %]

